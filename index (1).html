<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carlos Olivencia — Tax Division</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    .chat-log { max-height:300px; overflow-y:auto; display:flex; flex-direction:column; gap:10px; margin-bottom:14px; padding-right:4px; }
    .chat-log::-webkit-scrollbar { width:4px; }
    .chat-log::-webkit-scrollbar-thumb { background:#c9a84c55; border-radius:2px; }
    .msg { max-width:90%; padding:9px 13px; border-radius:12px; font-size:0.88rem; line-height:1.5; animation:fadeUp 0.25s ease; }
    @keyframes fadeUp { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }
    .msg.bot { align-self:flex-start; background:rgba(201,168,76,0.15); border:1px solid rgba(201,168,76,0.3); color:#f0e6c8; }
    .msg.bot strong { color:#c9a84c; }
    .msg.user { align-self:flex-end; background:rgba(255,255,255,0.12); border:1px solid rgba(255,255,255,0.2); color:#fff; text-align:right; }
    .quick-replies { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px; }
    .qr-btn { background:rgba(201,168,76,0.18); border:1px solid rgba(201,168,76,0.5); color:#c9a84c; padding:6px 14px; border-radius:20px; cursor:pointer; font-family:'Cinzel',serif; font-size:0.78rem; transition:background 0.2s,color 0.2s; }
    .qr-btn:hover { background:rgba(201,168,76,0.45); color:#fff; }
    .progress-wrap { margin-bottom:12px; }
    .progress-label { font-size:0.72rem; color:#c9a84c99; margin-bottom:4px; font-family:'Cinzel',serif; letter-spacing:0.05em; }
    .progress-bar { height:3px; background:rgba(201,168,76,0.15); border-radius:2px; overflow:hidden; }
    .progress-fill { height:100%; background:linear-gradient(90deg,#c9a84c,#f0d080); border-radius:2px; transition:width 0.5s ease; }
    .typing-dots { display:flex; gap:4px; align-items:center; padding:10px 13px; align-self:flex-start; }
    .typing-dots span { width:7px; height:7px; background:#c9a84c; border-radius:50%; animation:bounce 1.2s infinite; }
    .typing-dots span:nth-child(2){animation-delay:0.2s} .typing-dots span:nth-child(3){animation-delay:0.4s}
    @keyframes bounce { 0%,80%,100%{transform:translateY(0);opacity:0.4} 40%{transform:translateY(-6px);opacity:1} }
    .summary-box { background:rgba(201,168,76,0.08); border:1px solid rgba(201,168,76,0.25); border-radius:8px; padding:12px; font-size:0.78rem; color:#f0e6c8; line-height:1.8; margin-top:6px; }
    .summary-box dt { color:#c9a84c; font-weight:600; display:inline; }
    .summary-box dd { display:inline; margin:0; }
    .summary-box .row { margin-bottom:2px; }
    .intake-card { min-width:300px; width:clamp(300px,90vw,480px); }
  </style>
</head>
<body data-page="home">

  <!-- HEADER (hardcoded — no template.js needed) -->
  <header class="site-header">
    <div class="header-container">
      <div class="logo"><img src="logo.png" alt="Carlos Olivencia Logo"></div>
      <button class="hamburger" id="hamburger" aria-label="Open menu">
        <span></span><span></span><span></span>
      </button>
      <nav class="main-nav" id="mainNav">
        <a href="index.html" class="active">Home</a>
        <a href="services.html">Services</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="login.html">Login</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="intake-card" id="draggableCard">
      <h2>Carlos Olivencia &mdash; Tax Intake</h2>
      <div class="secure">&#9679; Secure Connection Active</div>
      <div class="progress-wrap">
        <div class="progress-label" id="progressLabel">Getting started&hellip;</div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
      </div>
      <div class="chat-log" id="chatLog"></div>
      <div class="quick-replies" id="quickReplies"></div>
      <div class="input-area">
        <input type="text" id="userInput" placeholder="Type your response..." autocomplete="off">
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </section>

  <!-- FOOTER (hardcoded — no template.js needed) -->
  <footer class="site-footer">
    &copy; 2025 Carlos Olivencia Tax &amp; Financial Services |
    <a href="privacy.html">Privacy Policy</a> |
    <a href="terms.html">Terms of Service</a>
  </footer>

  <script>
  // Everything in one place. No external dependencies.
  (function() {

    var STEPS = [
      { key:null, type:"quick",
        bot:"Welcome to <strong>Carlos Olivencia Tax Services</strong>.<br>I will guide you step-by-step through your 2025 tax intake. This information is encrypted and secure.<br><br>Are you ready to begin?",
        options:["Yes, let's start!","Tell me more first"],
        next:function(a){ return a.toLowerCase().indexOf("tell")!==-1?"explain":1; }
      },
      { key:"full_name", type:"text",
        bot:"Great! Let's start with the basics.<br><strong>What is your full legal name?</strong>",
        placeholder:"e.g. John Michael Smith", next:2
      },
      { key:"ssn_last4", type:"text",
        bot:"Thank you, <strong>{full_name}</strong>.<br>What are the <strong>last 4 digits of your SSN</strong>?",
        placeholder:"e.g. 1234",
        validate:function(v){ return /^\d{4}$/.test(v.trim())?null:"Please enter exactly 4 digits."; },
        next:3
      },
      { key:"dob", type:"text",
        bot:"What is your <strong>date of birth</strong>?",
        placeholder:"MM/DD/YYYY",
        validate:function(v){ return /^\d{1,2}\/\d{1,2}\/\d{4}$/.test(v.trim())?null:"Please use MM/DD/YYYY format."; },
        next:4
      },
      { key:"filing_status", type:"quick",
        bot:"What is your <strong>filing status</strong> for 2025?",
        options:["Single","Married Filing Jointly","Married Filing Separately","Head of Household","Qualifying Widow(er)"],
        next:5
      },
      { key:"address", type:"text",
        bot:"What is your <strong>current home address</strong>? (Street, City, State, ZIP)",
        placeholder:"e.g. 123 Main St, Miami, FL 33101", next:6
      },
      { key:"phone", type:"text",
        bot:"What is the best <strong>phone number</strong> to reach you?",
        placeholder:"e.g. (305) 555-1234", next:7
      },
      { key:"email", type:"text",
        bot:"What is your <strong>email address</strong>?",
        placeholder:"e.g. john@email.com",
        validate:function(v){ return v.indexOf("@")!==-1?null:"Please enter a valid email address."; },
        next:8
      },
      { key:"income_types", type:"quick", multi:true,
        bot:"What <strong>types of income</strong> did you receive in 2025?<br>Select all that apply, then press <em>\u2713 Done</em>.",
        options:["W-2 Employment","Self-Employed / 1099","Rental Income","Investment / Dividends","Retirement / Pension","Other"],
        next:9
      },
      { key:"has_dependents", type:"quick",
        bot:"Do you have any <strong>dependents</strong> to claim on your return?",
        options:["Yes","No"],
        next:function(a){ return a.toLowerCase()==="yes"?"dependents_info":10; }
      },
      { key:"deductions", type:"quick",
        bot:"Any <strong>deductions or credits</strong> to discuss?<br>(Education, home office, medical, charitable, etc.)",
        options:["Yes \u2014 I have some","Not sure \u2014 need guidance","No deductions"],
        next:11
      },
      { key:"prior_year", type:"quick",
        bot:"Did you file a federal tax return for <strong>tax year 2024</strong>?",
        options:["Yes","No","Not sure"],
        next:12
      },
      { key:"notes", type:"text",
        bot:"Almost done! Anything else you'd like <strong>Carlos to know</strong>?<br>Any IRS notices, special circumstances, or questions?",
        placeholder:"Type any additional notes, or 'None'",
        next:"done"
      }
    ];

    var SPECIAL = {
      explain:{ key:null, type:"quick",
        bot:"Carlos Olivencia holds a <strong>Master's in Taxation</strong> and an <strong>IRS Filing Season Certificate</strong>. Your data is collected securely to prepare your return with care for your family's future.<br><br>Ready to proceed?",
        options:["Yes, let's begin!"], next:1
      },
      dependents_info:{ key:"dependents_info", type:"text",
        bot:"Please provide the <strong>name and date of birth</strong> for each dependent (one per line).",
        placeholder:"e.g. Jane Smith, 03/15/2015", next:10
      }
    };

    var answers={}, currentStep=null, multiSel=[], TOTAL=12;

    var LOG   = document.getElementById("chatLog");
    var QR    = document.getElementById("quickReplies");
    var INPUT = document.getElementById("userInput");
    var SEND  = document.getElementById("sendBtn");
    var PFILL = document.getElementById("progressFill");
    var PLBL  = document.getElementById("progressLabel");

    function esc(s){ return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }
    function interp(t){ return t.replace(/\{(\w+)\}/g,function(_,k){return answers[k]||"";}); }
    function scroll(){ LOG.scrollTop=LOG.scrollHeight; }

    function msg(text,who){
      var d=document.createElement("div");
      d.className="msg "+who;
      d.innerHTML=who==="bot"?interp(text):esc(text);
      LOG.appendChild(d); scroll();
    }

    function typing(){
      var d=document.createElement("div");
      d.className="typing-dots"; d.id="tdots";
      d.innerHTML="<span></span><span></span><span></span>";
      LOG.appendChild(d); scroll();
    }
    function noTyping(){ var d=document.getElementById("tdots"); if(d)d.parentNode.removeChild(d); }

    function progress(i){
      PFILL.style.width=Math.round((i/TOTAL)*100)+"%";
      PLBL.textContent=i>0?"Step "+Math.min(i,TOTAL)+" of "+TOTAL:"Getting started\u2026";
    }

    function disableInput(yes){
      INPUT.disabled=SEND.disabled=yes;
      INPUT.placeholder=yes?"Please choose an option above\u2026":((currentStep&&currentStep.placeholder)||"Type your response...");
    }

    function render(step){
      currentStep=step;
      QR.innerHTML=""; multiSel=[];
      if(step.type==="quick"){
        disableInput(true);
        if(step.multi){
          step.options.forEach(function(opt){
            var b=document.createElement("button");
            b.className="qr-btn"; b.textContent=opt;
            b.onclick=function(e){
              e.stopPropagation();
              var i=multiSel.indexOf(opt);
              if(i===-1){multiSel.push(opt);b.style.background="rgba(201,168,76,0.55)";b.style.color="#fff";}
              else{multiSel.splice(i,1);b.style.background="";b.style.color="";}
            };
            QR.appendChild(b);
          });
          var done=document.createElement("button");
          done.className="qr-btn"; done.textContent="\u2713 Done";
          done.style.cssText="border-color:#c9a84c;background:rgba(201,168,76,0.3)";
          done.onclick=function(e){
            e.stopPropagation();
            var val=multiSel.length?multiSel.slice().join(", "):"None selected";
            var key=currentStep?currentStep.key:null;
            var nxt=currentStep?currentStep.next:"done";
            if(key)answers[key]=val;
            msg(val,"user");
            QR.innerHTML=""; multiSel=[];
            INPUT.value=""; disableInput(true);
            go(typeof nxt==="function"?nxt(val):nxt);
          };
          QR.appendChild(done);
        } else {
          step.options.forEach(function(opt){
            var b=document.createElement("button");
            b.className="qr-btn"; b.textContent=opt;
            b.onclick=function(){ answer(opt); };
            QR.appendChild(b);
          });
        }
      } else {
        disableInput(false);
        INPUT.focus();
      }
    }

    function go(ref){
      QR.innerHTML=""; multiSel=[];
      if(ref==="done"){complete();return;}
      var step;
      if(typeof ref==="string"&&SPECIAL[ref]){
        step=SPECIAL[ref]; typing();
        setTimeout(function(){noTyping();msg(step.bot,"bot");render(step);},700);
        return;
      }
      if(typeof ref==="number"&&STEPS[ref]){
        step=STEPS[ref]; progress(ref); typing();
        setTimeout(function(){noTyping();msg(step.bot,"bot");render(step);},800);
        return;
      }
      complete();
    }

    function answer(raw){
      var val=raw.trim(); if(!val)return;
      if(currentStep&&currentStep.validate){
        var e=currentStep.validate(val);
        if(e){msg("\u26a0 "+e,"bot");return;}
      }
      if(currentStep&&currentStep.key)answers[currentStep.key]=val;
      msg(val,"user");
      QR.innerHTML=""; multiSel=[];
      INPUT.value=""; disableInput(true);
      var nxt=(currentStep&&typeof currentStep.next==="function")?currentStep.next(val):(currentStep?currentStep.next:"done");
      go(nxt);
    }

    function complete(){
      progress(TOTAL); disableInput(true);
      QR.innerHTML=""; multiSel=[];
      typing();
      setTimeout(function(){
        noTyping();
        msg("Thank you, <strong>"+esc(answers.full_name||"there")+"</strong>! \uD83C\uDF89 Your intake is complete. Here is your summary:","bot");
        var fields=[
          ["Full Name",answers.full_name],
          ["SSN (last 4)",answers.ssn_last4?"****"+answers.ssn_last4:null],
          ["Date of Birth",answers.dob],
          ["Filing Status",answers.filing_status],
          ["Address",answers.address],
          ["Phone",answers.phone],
          ["Email",answers.email],
          ["Income Types",answers.income_types],
          ["Dependents",answers.dependents_info||(answers.has_dependents==="No"?"None":null)],
          ["Deductions",answers.deductions],
          ["Prior Year Filed",answers.prior_year],
          ["Notes",answers.notes]
        ].filter(function(r){return r[1];});
        var dl=document.createElement("dl"); dl.className="summary-box";
        fields.forEach(function(r){
          var div=document.createElement("div"); div.className="row";
          div.innerHTML="<dt>"+esc(r[0])+":</dt> <dd>"+esc(r[1])+"</dd>";
          dl.appendChild(div);
        });
        LOG.appendChild(dl); scroll();
        setTimeout(function(){
          msg("Carlos will review your information and contact you shortly. <strong>Thank you for trusting Carlos Olivencia Tax Services!</strong>","bot");
          scroll();
        },1000);
      },900);
    }

    SEND.addEventListener("click",function(){ if(!INPUT.disabled)answer(INPUT.value); });
    INPUT.addEventListener("keydown",function(e){ if(e.key==="Enter"&&!INPUT.disabled)answer(INPUT.value); });

    // Hamburger
    var hbtn=document.getElementById("hamburger");
    var hnav=document.getElementById("mainNav");
    hbtn.addEventListener("click",function(){
      var opening=!hbtn.classList.contains("open");
      hbtn.classList.toggle("open"); hnav.classList.toggle("open");
      var c=document.getElementById("draggableCard");
      if(c){c.style.visibility=opening?"hidden":"visible";c.style.opacity=opening?"0":"1";}
    });
    hnav.querySelectorAll("a").forEach(function(a){
      a.addEventListener("click",function(){
        hbtn.classList.remove("open"); hnav.classList.remove("open");
        var c=document.getElementById("draggableCard");
        if(c){c.style.visibility="visible";c.style.opacity="1";}
      });
    });

    // Drag
    var SKIP=["INPUT","BUTTON","TEXTAREA","SELECT","A","DL","DT","DD"];
    var card=document.getElementById("draggableCard");
    var hero=card.parentElement;
    var drag=false,ox,oy;
    card.addEventListener("mousedown",function(e){
      if(SKIP.indexOf(e.target.tagName)!==-1)return;
      drag=true;ox=e.clientX-card.offsetLeft;oy=e.clientY-card.offsetTop;e.preventDefault();
    });
    document.addEventListener("mousemove",function(e){
      if(!drag)return;
      var r=hero.getBoundingClientRect();
      card.style.left=Math.max(0,Math.min(e.clientX-ox,r.width-card.offsetWidth))+"px";
      card.style.top=Math.max(0,Math.min(e.clientY-oy,r.height-card.offsetHeight))+"px";
    });
    document.addEventListener("mouseup",function(){drag=false;});
    card.addEventListener("touchstart",function(e){
      if(SKIP.indexOf(e.target.tagName)!==-1)return;
      drag=true;ox=e.touches[0].clientX-card.offsetLeft;oy=e.touches[0].clientY-card.offsetTop;
    },{passive:true});
    document.addEventListener("touchmove",function(e){
      if(!drag)return;
      var r=hero.getBoundingClientRect();
      card.style.left=Math.max(0,Math.min(e.touches[0].clientX-ox,r.width-card.offsetWidth))+"px";
      card.style.top=Math.max(0,Math.min(e.touches[0].clientY-oy,r.height-card.offsetHeight))+"px";
      e.preventDefault();
    },{passive:false});
    document.addEventListener("touchend",function(){drag=false;});

    // Start
    go(0);

  })();
  </script>

</body>
</html>
