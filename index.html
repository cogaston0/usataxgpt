<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carlos Olivencia â€” Tax Division</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    /* â”€â”€ Chat conversation styles â”€â”€ */
    .chat-log {
      max-height: 320px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 14px;
      padding-right: 4px;
    }
    .chat-log::-webkit-scrollbar { width: 4px; }
    .chat-log::-webkit-scrollbar-track { background: transparent; }
    .chat-log::-webkit-scrollbar-thumb { background: #c9a84c55; border-radius: 2px; }

    .msg {
      max-width: 90%;
      padding: 9px 13px;
      border-radius: 12px;
      font-size: 0.88rem;
      line-height: 1.5;
      animation: fadeUp 0.25s ease;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(6px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .msg.bot {
      align-self: flex-start;
      background: rgba(201,168,76,0.15);
      border: 1px solid rgba(201,168,76,0.3);
      color: #f0e6c8;
    }
    .msg.user {
      align-self: flex-end;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff;
      text-align: right;
    }
    .msg.bot strong { color: #c9a84c; }

    /* Quick-reply buttons */
    .quick-replies {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
      animation: fadeUp 0.3s ease;
    }
    .qr-btn {
      background: rgba(201,168,76,0.18);
      border: 1px solid rgba(201,168,76,0.5);
      color: #c9a84c;
      padding: 6px 14px;
      border-radius: 20px;
      cursor: pointer;
      font-family: 'Cinzel', serif;
      font-size: 0.78rem;
      transition: background 0.2s, color 0.2s;
    }
    .qr-btn:hover {
      background: rgba(201,168,76,0.45);
      color: #fff;
    }

    /* Progress bar */
    .progress-wrap {
      margin-bottom: 12px;
    }
    .progress-label {
      font-size: 0.72rem;
      color: #c9a84c99;
      margin-bottom: 4px;
      font-family: 'Cinzel', serif;
      letter-spacing: 0.05em;
    }
    .progress-bar {
      height: 3px;
      background: rgba(201,168,76,0.15);
      border-radius: 2px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #c9a84c, #f0d080);
      border-radius: 2px;
      transition: width 0.5s ease;
    }

    /* Typing indicator */
    .typing-dots {
      display: flex;
      gap: 4px;
      align-items: center;
      padding: 10px 13px;
      align-self: flex-start;
    }
    .typing-dots span {
      width: 7px; height: 7px;
      background: #c9a84c;
      border-radius: 50%;
      animation: bounce 1.2s infinite;
    }
    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes bounce {
      0%,80%,100% { transform: translateY(0); opacity:0.4; }
      40% { transform: translateY(-6px); opacity:1; }
    }

    /* Summary box */
    .summary-box {
      background: rgba(201,168,76,0.08);
      border: 1px solid rgba(201,168,76,0.25);
      border-radius: 8px;
      padding: 12px;
      font-size: 0.78rem;
      color: #f0e6c8;
      line-height: 1.8;
      margin-top: 6px;
    }
    .summary-box dt { color: #c9a84c; font-weight: 600; display: inline; }
    .summary-box dd { display: inline; margin: 0; }
    .summary-box .row { margin-bottom: 2px; }

    .intake-card { min-width: 300px; width: clamp(300px, 90vw, 480px); }
  </style>
</head>

<body data-page="home">

  <!-- ===== HEADER ===== -->
  <header class="site-header">
    <div class="header-container">
      <div class="logo">
        <img src="logo.png" alt="Carlos Olivencia Logo">
      </div>
      <button class="hamburger" id="hamburger" aria-label="Open menu">
        <span></span><span></span><span></span>
      </button>
      <nav class="main-nav" id="mainNav">
        <a href="index.html" class="active">Home</a>
        <a href="services.html">Services</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="login.html">Login</a>
      </nav>
    </div>
  </header>

  <!-- ===== HERO / INTAKE ===== -->
  <section class="hero">
    <div class="intake-card" id="draggableCard">
      <h2>Carlos Olivencia â€” Tax Intake</h2>
      <div class="secure">â— Secure Connection Active</div>

      <!-- Progress -->
      <div class="progress-wrap">
        <div class="progress-label" id="progressLabel">Getting startedâ€¦</div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
      </div>

      <!-- Chat log -->
      <div class="chat-log" id="chatLog"></div>

      <!-- Quick replies -->
      <div class="quick-replies" id="quickReplies"></div>

      <!-- Input -->
      <div class="input-area">
        <input type="text" id="userInput" placeholder="Type your response..." autocomplete="off">
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </section>

  <!-- ===== FOOTER ===== -->
  <footer class="site-footer">
    Â© 2025 Carlos Olivencia Tax &amp; Financial Services |
    <a href="privacy.html">Privacy Policy</a> |
    <a href="terms.html">Terms of Service</a>
  </footer>

  <script>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       INTAKE CONVERSATION FLOW
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    var STEPS = [
      {
        key: null,
        bot: "Welcome to <strong>Carlos Olivencia Tax Services</strong>.<br>I will guide you step-by-step through your 2025 tax intake. This information is encrypted and secure.<br><br>Are you ready to begin?",
        type: "quick",
        options: ["Yes, let's start!", "Tell me more first"],
        next: function(ans) { return ans.toLowerCase().indexOf("tell") !== -1 ? "explain" : 1; }
      },
      {
        key: "full_name",
        bot: "Great! Let's start with the basics.<br><strong>What is your full legal name?</strong>",
        type: "text",
        placeholder: "e.g. John Michael Smith",
        next: 2
      },
      {
        key: "ssn_last4",
        bot: "Thank you, <strong>{full_name}</strong>.<br>For verification, what are the <strong>last 4 digits of your SSN</strong>?",
        type: "text",
        placeholder: "e.g. 1234",
        validate: function(v) { return /^\d{4}$/.test(v.trim()) ? null : "Please enter exactly 4 digits."; },
        next: 3
      },
      {
        key: "dob",
        bot: "What is your <strong>date of birth</strong>?",
        type: "text",
        placeholder: "MM/DD/YYYY",
        validate: function(v) { return /^\d{1,2}\/\d{1,2}\/\d{4}$/.test(v.trim()) ? null : "Please use MM/DD/YYYY format."; },
        next: 4
      },
      {
        key: "filing_status",
        bot: "What is your <strong>filing status</strong> for 2025?",
        type: "quick",
        options: ["Single", "Married Filing Jointly", "Married Filing Separately", "Head of Household", "Qualifying Widow(er)"],
        next: 5
      },
      {
        key: "address",
        bot: "What is your <strong>current home address</strong>? (Street, City, State, ZIP)",
        type: "text",
        placeholder: "e.g. 123 Main St, Miami, FL 33101",
        next: 6
      },
      {
        key: "phone",
        bot: "What is the best <strong>phone number</strong> to reach you?",
        type: "text",
        placeholder: "e.g. (305) 555-1234",
        next: 7
      },
      {
        key: "email",
        bot: "What is your <strong>email address</strong>?",
        type: "text",
        placeholder: "e.g. john@email.com",
        validate: function(v) { return v.indexOf("@") !== -1 ? null : "Please enter a valid email address."; },
        next: 8
      },
      {
        key: "income_types",
        bot: "What <strong>types of income</strong> did you receive in 2025?<br>Select all that apply, then press <em>Done</em>.",
        type: "quick",
        options: ["W-2 Employment", "Self-Employed / 1099", "Rental Income", "Investment / Dividends", "Retirement / Pension", "Other"],
        multi: true,
        next: 9
      },
      {
        key: "has_dependents",
        bot: "Do you have any <strong>dependents</strong> (children or relatives) to claim on your return?",
        type: "quick",
        options: ["Yes", "No"],
        next: function(ans) { return ans.toLowerCase() === "yes" ? "dependents_info" : 10; }
      },
      {
        key: "deductions",
        bot: "Are you aware of any <strong>deductions or credits</strong> to discuss?<br>(Education, home office, medical, charitable, etc.)",
        type: "quick",
        options: ["Yes â€” I have some", "Not sure â€” need guidance", "No deductions"],
        next: 11
      },
      {
        key: "prior_year",
        bot: "Did you file a federal tax return for <strong>tax year 2024</strong>?",
        type: "quick",
        options: ["Yes", "No", "Not sure"],
        next: 12
      },
      {
        key: "notes",
        bot: "Almost done! Is there anything else you'd like <strong>Carlos to know</strong>?<br>Any IRS notices, special circumstances, or questions?",
        type: "text",
        placeholder: "Type any additional notes, or type 'None'",
        next: "done"
      }
    ];

    var SPECIAL_STEPS = {
      explain: {
        key: null,
        bot: "Carlos Olivencia holds a <strong>Master's degree in Taxation</strong> and an <strong>IRS Filing Season Certificate</strong>. Your data is collected securely to prepare your return with care for your family's financial future.<br><br>Ready to proceed?",
        type: "quick",
        options: ["Yes, let's begin!"],
        next: 1
      },
      dependents_info: {
        key: "dependents_info",
        bot: "Please provide the <strong>name and date of birth</strong> for each dependent (one per line).",
        type: "text",
        placeholder: "e.g. Jane Smith, 03/15/2015",
        next: 10
      }
    };

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STATE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    var answers = {};
    var currentStep = null;
    var multiSelections = [];
    var TOTAL_STEPS = 12;

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DOM REFS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    var chatLog       = document.getElementById("chatLog");
    var quickReplies  = document.getElementById("quickReplies");
    var userInput     = document.getElementById("userInput");
    var sendBtn       = document.getElementById("sendBtn");
    var progressFill  = document.getElementById("progressFill");
    var progressLabel = document.getElementById("progressLabel");

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HELPERS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function interpolate(text) {
      return text.replace(/\{(\w+)\}/g, function(_, k) { return answers[k] || ""; });
    }
    function escapeHTML(s) {
      return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
    }
    function scrollLog() {
      chatLog.scrollTop = chatLog.scrollHeight;
    }
    function addMsg(text, who) {
      var div = document.createElement("div");
      div.className = "msg " + who;
      div.innerHTML = who === "bot" ? interpolate(text) : escapeHTML(text);
      chatLog.appendChild(div);
      scrollLog();
    }
    function showTyping() {
      var dots = document.createElement("div");
      dots.className = "typing-dots";
      dots.id = "typingIndicator";
      dots.innerHTML = "<span></span><span></span><span></span>";
      chatLog.appendChild(dots);
      scrollLog();
    }
    function removeTyping() {
      var d = document.getElementById("typingIndicator");
      if (d) d.parentNode.removeChild(d);
    }
    function setProgress(stepIndex) {
      var pct = Math.round((stepIndex / TOTAL_STEPS) * 100);
      progressFill.style.width = pct + "%";
      progressLabel.textContent = stepIndex > 0
        ? "Step " + Math.min(stepIndex, TOTAL_STEPS) + " of " + TOTAL_STEPS
        : "Getting startedâ€¦";
    }
    function clearQuickReplies() {
      quickReplies.innerHTML = "";
      multiSelections = [];
    }
    function setInputDisabled(disabled) {
      userInput.disabled = disabled;
      sendBtn.disabled = disabled;
      if (!disabled) {
        userInput.placeholder = (currentStep && currentStep.placeholder) ? currentStep.placeholder : "Type your response...";
      } else {
        userInput.placeholder = "Please choose an option aboveâ€¦";
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RENDER A STEP
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function renderStep(step) {
      currentStep = step;
      clearQuickReplies();

      if (step.type === "quick") {
        setInputDisabled(true);

        if (step.multi) {
          step.options.forEach(function(opt) {
            var b = document.createElement("button");
            b.className = "qr-btn";
            b.textContent = opt;
            b.addEventListener("click", function() {
              var idx = multiSelections.indexOf(opt);
              if (idx === -1) {
                multiSelections.push(opt);
                b.style.background = "rgba(201,168,76,0.55)";
                b.style.color = "#fff";
              } else {
                multiSelections.splice(idx, 1);
                b.style.background = "";
                b.style.color = "";
              }
            });
            quickReplies.appendChild(b);
          });
          var doneBtn = document.createElement("button");
          doneBtn.className = "qr-btn";
          doneBtn.textContent = "âœ“ Done";
          doneBtn.style.borderColor = "#c9a84c";
          doneBtn.style.background = "rgba(201,168,76,0.3)";
          doneBtn.addEventListener("click", function() {
            var val = multiSelections.length ? multiSelections.join(", ") : "None selected";
            handleAnswer(val);
          });
          quickReplies.appendChild(doneBtn);

        } else {
          step.options.forEach(function(opt) {
            var b = document.createElement("button");
            b.className = "qr-btn";
            b.textContent = opt;
            b.addEventListener("click", function() { handleAnswer(opt); });
            quickReplies.appendChild(b);
          });
        }

      } else {
        setInputDisabled(false);
        userInput.focus();
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GO TO STEP
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function goToStep(stepRef) {
      clearQuickReplies();

      if (stepRef === "done") {
        showCompletion();
        return;
      }

      var step;
      if (typeof stepRef === "string" && SPECIAL_STEPS[stepRef]) {
        step = SPECIAL_STEPS[stepRef];
        showTyping();
        setTimeout(function() {
          removeTyping();
          addMsg(step.bot, "bot");
          renderStep(step);
        }, 700);
        return;
      }

      if (typeof stepRef === "number" && STEPS[stepRef]) {
        step = STEPS[stepRef];
        setProgress(stepRef);
        showTyping();
        setTimeout(function() {
          removeTyping();
          addMsg(step.bot, "bot");
          renderStep(step);
        }, 800);
        return;
      }

      showCompletion();
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HANDLE ANSWER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function handleAnswer(rawVal) {
      var val = rawVal.trim();
      if (!val) return;

      if (currentStep && currentStep.validate) {
        var err = currentStep.validate(val);
        if (err) {
          addMsg("âš  " + err, "bot");
          return;
        }
      }

      if (currentStep && currentStep.key) {
        answers[currentStep.key] = val;
      }

      addMsg(val, "user");
      clearQuickReplies();
      userInput.value = "";
      setInputDisabled(true);

      var next = (currentStep && typeof currentStep.next === "function")
        ? currentStep.next(val)
        : (currentStep ? currentStep.next : "done");

      goToStep(next);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       COMPLETION
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function showCompletion() {
      setProgress(TOTAL_STEPS);
      setInputDisabled(true);
      clearQuickReplies();

      showTyping();
      setTimeout(function() {
        removeTyping();
        var name = answers.full_name || "there";
        addMsg("Thank you, <strong>" + escapeHTML(name) + "</strong>! ğŸ‰ Your intake is complete. Here is a summary:", "bot");

        var fields = [
          ["Full Name",        answers.full_name],
          ["SSN (last 4)",     answers.ssn_last4 ? "****" + answers.ssn_last4 : null],
          ["Date of Birth",    answers.dob],
          ["Filing Status",    answers.filing_status],
          ["Address",          answers.address],
          ["Phone",            answers.phone],
          ["Email",            answers.email],
          ["Income Types",     answers.income_types],
          ["Dependents",       answers.dependents_info || (answers.has_dependents === "No" ? "None" : null)],
          ["Deductions",       answers.deductions],
          ["Prior Year Filed", answers.prior_year],
          ["Notes",            answers.notes]
        ].filter(function(row) { return row[1]; });

        var dl = document.createElement("dl");
        dl.className = "summary-box";
        fields.forEach(function(row) {
          var div = document.createElement("div");
          div.className = "row";
          div.innerHTML = "<dt>" + escapeHTML(row[0]) + ":</dt> <dd>" + escapeHTML(row[1]) + "</dd>";
          dl.appendChild(div);
        });
        chatLog.appendChild(dl);
        scrollLog();

        setTimeout(function() {
          addMsg("Carlos will review your information and contact you shortly to schedule your consultation. <strong>Thank you for trusting Carlos Olivencia Tax Services!</strong>", "bot");
          scrollLog();
        }, 1000);
      }, 900);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SEND EVENTS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    sendBtn.addEventListener("click", function() {
      if (!userInput.disabled) handleAnswer(userInput.value);
    });
    userInput.addEventListener("keydown", function(e) {
      if (e.key === "Enter" && !userInput.disabled) handleAnswer(userInput.value);
    });

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       START
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    window.addEventListener("load", function() {
      goToStep(0);
    });

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HAMBURGER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    var hamburgerBtn = document.getElementById("hamburger");
    var navEl  = document.getElementById("mainNav");
    var cardEl = document.getElementById("draggableCard");

    hamburgerBtn.addEventListener("click", function() {
      var isOpening = !hamburgerBtn.classList.contains("open");
      hamburgerBtn.classList.toggle("open");
      navEl.classList.toggle("open");
      cardEl.style.visibility = isOpening ? "hidden" : "visible";
      cardEl.style.opacity    = isOpening ? "0" : "1";
    });
    navEl.querySelectorAll("a").forEach(function(link) {
      link.addEventListener("click", function() {
        hamburgerBtn.classList.remove("open");
        navEl.classList.remove("open");
        cardEl.style.visibility = "visible";
        cardEl.style.opacity    = "1";
      });
    });

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DRAG
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    var DRAG_EXCLUDE = ["INPUT","BUTTON","TEXTAREA","SELECT","A","DL","DT","DD"];
    var heroEl = cardEl.parentElement;
    var isDragging = false, offsetX, offsetY;

    cardEl.addEventListener("mousedown", function(e) {
      if (DRAG_EXCLUDE.indexOf(e.target.tagName) !== -1) return;
      isDragging = true;
      offsetX = e.clientX - cardEl.offsetLeft;
      offsetY = e.clientY - cardEl.offsetTop;
      e.preventDefault();
    });
    document.addEventListener("mousemove", function(e) {
      if (!isDragging) return;
      var r = heroEl.getBoundingClientRect();
      cardEl.style.left = Math.max(0, Math.min(e.clientX - offsetX, r.width  - cardEl.offsetWidth))  + "px";
      cardEl.style.top  = Math.max(0, Math.min(e.clientY - offsetY, r.height - cardEl.offsetHeight)) + "px";
    });
    document.addEventListener("mouseup", function() { isDragging = false; });

    cardEl.addEventListener("touchstart", function(e) {
      if (DRAG_EXCLUDE.indexOf(e.target.tagName) !== -1) return;
      isDragging = true;
      offsetX = e.touches[0].clientX - cardEl.offsetLeft;
      offsetY = e.touches[0].clientY - cardEl.offsetTop;
    }, { passive: true });
    document.addEventListener("touchmove", function(e) {
      if (!isDragging) return;
      var r = heroEl.getBoundingClientRect();
      cardEl.style.left = Math.max(0, Math.min(e.touches[0].clientX - offsetX, r.width  - cardEl.offsetWidth))  + "px";
      cardEl.style.top  = Math.max(0, Math.min(e.touches[0].clientY - offsetY, r.height - cardEl.offsetHeight)) + "px";
      e.preventDefault();
    }, { passive: false });
    document.addEventListener("touchend", function() { isDragging = false; });
  </script>

</body>
</html>
