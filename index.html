<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carlos Olivencia ‚Äî Tax Division</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    /* ‚îÄ‚îÄ Intake Chat Styles ‚îÄ‚îÄ */
    .chat-log {
      max-height: 220px;
      overflow-y: auto;
      margin-bottom: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      scroll-behavior: smooth;
    }
    .chat-msg {
      max-width: 85%;
      padding: 8px 12px;
      border-radius: 12px;
      font-size: 0.88rem;
      line-height: 1.45;
    }
    .chat-msg.bot {
      background: rgba(201,168,76,0.18);
      border: 1px solid rgba(201,168,76,0.35);
      color: #f0e6c8;
      align-self: flex-start;
      border-bottom-left-radius: 3px;
    }
    .chat-msg.user {
      background: rgba(201,168,76,0.32);
      color: #fff;
      align-self: flex-end;
      border-bottom-right-radius: 3px;
    }
    /* Progress bar */
    .progress-wrap {
      margin-bottom: 10px;
    }
    .progress-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: #c9a84c;
      margin-bottom: 4px;
    }
    .progress-bar-bg {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      height: 6px;
      overflow: hidden;
    }
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #c9a84c, #f0d080);
      border-radius: 10px;
      transition: width 0.4s ease;
      width: 0%;
    }
    /* Quick-reply buttons */
    .quick-replies {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }
    .quick-btn {
      background: rgba(201,168,76,0.2);
      border: 1px solid #c9a84c;
      color: #c9a84c;
      padding: 5px 12px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: background 0.2s;
    }
    .quick-btn:hover {
      background: rgba(201,168,76,0.4);
      color: #fff;
    }
    .intake-done {
      text-align: center;
      color: #c9a84c;
      font-size: 0.85rem;
      margin-top: 8px;
    }
  </style>
</head>

<body data-page="home">

  <!-- ===== HEADER ===== -->
  <header class="site-header">
    <div class="header-container">
      <div class="logo">
        <img src="logo.png" alt="Carlos Olivencia Logo">
      </div>
      <button class="hamburger" id="hamburger" aria-label="Open menu">
        <span></span><span></span><span></span>
      </button>
      <nav class="main-nav" id="mainNav">
        <a href="index.html" class="active">Home</a>
        <a href="services.html">Services</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="login.html">Login</a>
      </nav>
    </div>
  </header>

  <!-- ===== HERO / INTAKE ===== -->
  <section class="hero">
    <div class="intake-card" id="draggableCard">
      <h2>Carlos Olivencia ‚Äî Tax Intake</h2>
      <div class="secure">‚óè Secure Connection Active</div>

      <!-- Progress Bar -->
      <div class="progress-wrap">
        <div class="progress-label">
          <span id="progressStep">Getting Started</span>
          <span id="progressPct">0%</span>
        </div>
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" id="progressFill"></div>
        </div>
      </div>

      <!-- Chat Log -->
      <div class="chat-log" id="chatLog"></div>

      <!-- Quick Reply Buttons -->
      <div class="quick-replies" id="quickReplies"></div>

      <!-- Input Area -->
      <div class="input-area" id="inputArea">
        <input type="text" id="userInput" placeholder="Type your response...">
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </section>

  <!-- ===== FOOTER ===== -->
  <footer class="site-footer">
    ¬© 2025 Carlos Olivencia Tax &amp; Financial Services |
    <a href="privacy.html">Privacy Policy</a> |
    <a href="terms.html">Terms of Service</a>
  </footer>

  <script>
    // ‚îÄ‚îÄ Hamburger ‚îÄ‚îÄ
    const btn = document.getElementById("hamburger");
    const nav = document.getElementById("mainNav");
    const card = document.getElementById("draggableCard");

    btn.addEventListener("click", function () {
      const isOpening = !btn.classList.contains("open");
      btn.classList.toggle("open");
      nav.classList.toggle("open");
      card.style.visibility = isOpening ? "hidden" : "visible";
      card.style.opacity    = isOpening ? "0" : "1";
    });

    nav.querySelectorAll("a").forEach(function(link) {
      link.addEventListener("click", function () {
        btn.classList.remove("open");
        nav.classList.remove("open");
        card.style.visibility = "visible";
        card.style.opacity    = "1";
      });
    });

    // ‚îÄ‚îÄ Drag (mouse + touch) ‚îÄ‚îÄ
    const hero = card.parentElement;
    let isDragging = false, offsetX, offsetY;

    function startDrag(x, y) {
      isDragging = true;
      offsetX = x - card.offsetLeft;
      offsetY = y - card.offsetTop;
    }
    function moveDrag(x, y) {
      if (!isDragging) return;
      const heroRect = hero.getBoundingClientRect();
      let newLeft = Math.max(0, Math.min(x - offsetX, heroRect.width  - card.offsetWidth));
      let newTop  = Math.max(0, Math.min(y - offsetY, heroRect.height - card.offsetHeight));
      card.style.left = newLeft + "px";
      card.style.top  = newTop  + "px";
    }
    function endDrag() { isDragging = false; }

    card.addEventListener("mousedown",  function(e) {
      if (e.target.tagName === "INPUT" || e.target.tagName === "BUTTON") return;
      startDrag(e.clientX, e.clientY); e.preventDefault();
    });
    document.addEventListener("mousemove", function(e) { moveDrag(e.clientX, e.clientY); });
    document.addEventListener("mouseup",   endDrag);

    card.addEventListener("touchstart", function(e) {
      if (e.target.tagName === "INPUT" || e.target.tagName === "BUTTON") return;
      startDrag(e.touches[0].clientX, e.touches[0].clientY);
      e.preventDefault();
    }, { passive: false });
    document.addEventListener("touchmove", function(e) {
      moveDrag(e.touches[0].clientX, e.touches[0].clientY);
      e.preventDefault();
    }, { passive: false });
    document.addEventListener("touchend", endDrag);

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // ‚îÄ‚îÄ INTAKE CHATBOT ‚îÄ‚îÄ
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const chatLog      = document.getElementById("chatLog");
    const quickReplies = document.getElementById("quickReplies");
    const inputArea    = document.getElementById("inputArea");
    const userInput    = document.getElementById("userInput");
    const sendBtn      = document.getElementById("sendBtn");
    const progressFill = document.getElementById("progressFill");
    const progressStep = document.getElementById("progressStep");
    const progressPct  = document.getElementById("progressPct");

    // Collected data object
    const intakeData = {};

    // ‚îÄ‚îÄ Steps definition ‚îÄ‚îÄ
    // type: "yesno" | "text" | "select" | "done"
    const steps = [
      {
        key: null,
        label: "Welcome",
        bot: "Welcome to Carlos Olivencia Tax Services. I will guide you step-by-step through your 2025 tax intake. This information is encrypted and secure.\n\nAre you ready to begin?",
        type: "yesno",
        yesNext: 1,
        noMsg: "No problem! Come back when you're ready. You can refresh this page to start again."
      },
      {
        key: "fullName",
        label: "Full Name",
        bot: "Great! Let's start with the basics.\n\nWhat is your full legal name?",
        type: "text",
        placeholder: "e.g. John A. Smith"
      },
      {
        key: "email",
        label: "Email",
        bot: "What is your email address?",
        type: "text",
        placeholder: "e.g. john@email.com"
      },
      {
        key: "phone",
        label: "Phone",
        bot: "What is the best phone number to reach you?",
        type: "text",
        placeholder: "e.g. (787) 555-1234"
      },
      {
        key: "filingStatus",
        label: "Filing Status",
        bot: "What is your filing status for 2024?",
        type: "select",
        options: ["Single", "Married Filing Jointly", "Married Filing Separately", "Head of Household", "Qualifying Widow(er)"]
      },
      {
        key: "dependents",
        label: "Dependents",
        bot: "Do you have any dependents (children or other qualifying persons)?",
        type: "yesno",
        yesNext: 6,
        noNext: 7
      },
      {
        key: "dependentCount",
        label: "# of Dependents",
        bot: "How many dependents will you be claiming?",
        type: "text",
        placeholder: "e.g. 2"
      },
      {
        key: "incomeTypes",
        label: "Income Types",
        bot: "What types of income did you receive in 2024? (Select all that apply ‚Äî type all that apply separated by commas)",
        type: "select",
        options: ["W-2 Employment", "Self-Employment / 1099", "Rental Income", "Investments / Dividends", "Social Security", "Other"]
      },
      {
        key: "selfEmployed",
        label: "Self-Employed",
        bot: "Were you self-employed or did you have any freelance / gig income in 2024?",
        type: "yesno",
        yesNext: 9,
        noNext: 10
      },
      {
        key: "businessExpenses",
        label: "Business Expenses",
        bot: "Do you have business expenses to deduct (home office, vehicle, supplies, etc.)?",
        type: "yesno",
        yesNext: 10,
        noNext: 10
      },
      {
        key: "homeOwner",
        label: "Home Ownership",
        bot: "Do you own a home?",
        type: "yesno",
        yesNext: 11,
        noNext: 12
      },
      {
        key: "mortgage",
        label: "Mortgage Interest",
        bot: "Did you pay mortgage interest in 2024? (You should have a Form 1098)",
        type: "yesno",
        yesNext: 12,
        noNext: 12
      },
      {
        key: "priorYearReturn",
        label: "Prior Year",
        bot: "Did you file a federal tax return last year (2023)?",
        type: "yesno",
        yesNext: 13,
        noNext: 13
      },
      {
        key: "refundOrOwed",
        label: "Prior Year Result",
        bot: "Did you receive a refund or owe taxes last year?",
        type: "select",
        options: ["Received a Refund", "Owed Taxes", "Broke Even", "Did Not File"]
      },
      {
        key: "additionalInfo",
        label: "Additional Info",
        bot: "Is there anything else you'd like me to know before we proceed? (Any life changes, IRS notices, new income sources, etc.)",
        type: "text",
        placeholder: "Type here or say 'none'"
      },
      {
        key: null,
        label: "Complete",
        bot: null,
        type: "done"
      }
    ];

    const TOTAL_STEPS = steps.length - 1; // exclude welcome & done for progress
    let currentStep = 0;

    function updateProgress(stepIndex) {
      const pct = Math.round((stepIndex / TOTAL_STEPS) * 100);
      progressFill.style.width = pct + "%";
      progressPct.textContent = pct + "%";
      const s = steps[stepIndex];
      progressStep.textContent = s ? s.label : "Complete";
    }

    function addMsg(text, who) {
      const div = document.createElement("div");
      div.className = "chat-msg " + who;
      div.textContent = text;
      chatLog.appendChild(div);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function clearQuickReplies() {
      quickReplies.innerHTML = "";
    }

    function showStep(index) {
      if (index >= steps.length) index = steps.length - 1;
      currentStep = index;
      const step = steps[index];
      updateProgress(index);

      if (step.type === "done") {
        clearQuickReplies();
        inputArea.style.display = "none";
        addMsg("‚úÖ Thank you, " + (intakeData.fullName || "valued client") + "! Your intake is complete. Carlos will review your information and contact you shortly to schedule your appointment.", "bot");
        const summary = document.createElement("div");
        summary.className = "intake-done";
        summary.innerHTML = "üìã <strong>Summary saved.</strong> Check your email for confirmation.";
        chatLog.appendChild(summary);
        console.log("Intake Data:", intakeData);
        return;
      }

      if (step.bot) addMsg(step.bot, "bot");

      clearQuickReplies();

      if (step.type === "yesno") {
        inputArea.style.display = "none";
        ["Yes", "No"].forEach(function(label) {
          const b = document.createElement("button");
          b.className = "quick-btn";
          b.textContent = label;
          b.addEventListener("click", function() {
            addMsg(label, "user");
            clearQuickReplies();
            if (step.key) intakeData[step.key] = label;
            if (label === "No" && step.noMsg) {
              inputArea.style.display = "none";
              addMsg(step.noMsg, "bot");
              updateProgress(TOTAL_STEPS);
              return;
            }
            const next = label === "Yes" ? (step.yesNext !== undefined ? step.yesNext : index + 1)
                                         : (step.noNext  !== undefined ? step.noNext  : index + 1);
            showStep(next);
          });
          quickReplies.appendChild(b);
        });

      } else if (step.type === "select") {
        inputArea.style.display = "none";
        step.options.forEach(function(opt) {
          const b = document.createElement("button");
          b.className = "quick-btn";
          b.textContent = opt;
          b.addEventListener("click", function() {
            addMsg(opt, "user");
            clearQuickReplies();
            intakeData[step.key] = opt;
            showStep(index + 1);
          });
          quickReplies.appendChild(b);
        });

      } else if (step.type === "text") {
        inputArea.style.display = "flex";
        userInput.placeholder = step.placeholder || "Type your response...";
        userInput.value = "";
        userInput.focus();
      }
    }

    function handleSend() {
      const val = userInput.value.trim();
      if (!val) return;
      const step = steps[currentStep];
      if (step.type !== "text") return;
      addMsg(val, "user");
      intakeData[step.key] = val;
      userInput.value = "";
      showStep(currentStep + 1);
    }

    sendBtn.addEventListener("click", handleSend);
    userInput.addEventListener("keydown", function(e) {
      if (e.key === "Enter") handleSend();
    });

    // ‚îÄ‚îÄ Start ‚îÄ‚îÄ
    showStep(0);
  </script>

</body>
</html>
